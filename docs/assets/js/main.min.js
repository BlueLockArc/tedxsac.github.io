function showhide(show = "", hide = "") {
    if (show != "") document.getElementById(show).classList.remove("togglable");
    if (hide != "") document.getElementById(hide).classList.add("togglable");
}

const sleep = ms => new Promise(r => setTimeout(r, ms));

async function check_email() {
    $("#continue-btn").hide();
    $("#email-loading-icon").show();
    $("#email-alert-box").hide();
    var email = $("#email-input").val();
    await fetch("https://tedxsac.up.railway.app/check/" + email)
        .then(async (response) => {
            const statusCode = response.status;
            const responseData = await response.json();
            if (statusCode === 200) {
                // Email is proper and doesnt exist in db so continue
                $("#email-check-row").hide();
                $("#register-form-row").show();
            } else if (statusCode === 520) { //handled error
                showEmailAlert(responseData.msg);
            } else if (statusCode === 222) {
                console.log("payment fully done show ticket");
            } else if (statusCode === 310) {
                resp = ""
                msg = responseData.msg;
                if (msg == "pending") {
                    resp = "Payment is pending manual Verification.\nIt may take upto 48hrs to verify your payment.\nPlease wait for the confirmation email.";
                } else if (msg in ["pending1", "pending2"]) {
                    resp = "Your last payment is pending manual Verification.\nIt may take upto 48hrs to verify your payment.\nPlease wait for the confirmation email.";
                } else if (msg == "verified") {
                    console.log("payment fully done show ticket");
                } else if (msg)
                else {
                    console.log('Unexpected status code:', statusCode);
                }
                if (resp) {
                    showEmailAlert(resp);
                }

            })
        .catch(error => {
            console.error('Error:', error);
        });

    $("#email-loading-icon").hide();
    $("#continue-btn").show();
}

function showEmailAlert(text) {
    $("#email-alert-box").show();
    $("#email-alert-text").html(text);
}
$(document).on('click touchstart', function () {
    var aloy = $('input[name="int-ext"]:checked').val();
    var payment_type = $('input[name="partial-full"]:checked').val();
    if (aloy) {
        showhide("payment-type-row");
        if (aloy == 1) {
            showhide("regno-row");
            $("#partial-radio-btn").prop("disabled", false);
            $("#regno-input").prop("required", true);
        }
        else if (aloy == 0) {
            showhide("", "regno-row");
            $("#partial-radio-btn").prop("disabled", true);
            $("#partial-radio-btn").prop("checked", false);
            $("#regno-input").prop("required", false);
            showhide("full-pay-label", "partial-pay-label");
        }
    }
    var payment_type = $('input[name="partial-full"]:checked').val();
    if (!payment_type) {
        showhide("", "qr-code-col");
    }
    if (payment_type) {
        showhide("qr-code-col");
        if (payment_type == "partial")
            showhide("partial-pay-label", "full-pay-label");
        else if (payment_type == "full")
            showhide("full-pay-label", "partial-pay-label");
    }
});

async function submit_form() {
    $("#submit-btn").hide();
    $("#submit-loading").show();
    var full_name = $("#name-input").val();
    var email = $("#email-input").val();
    var wa_number = window.wa_iti.getNumber();
    var ph_number = window.ph_iti.getNumber();
    var aloy = $('input[name="int-ext"]:checked').val();
    var regno = $("#regno-input").val();
    var payment_type = $('input[name="partial-full"]:checked').val();
    var upi_ref_no = $("#upi-ref-input").val();

    if (!full_name || !email || !wa_number || !aloy || !payment_type || !upi_ref_no) {
        alert("Please fill all the required fields.");
    }
    else if (!window.wa_iti.isValidNumber()) {
        $("#name-input")[0].scrollIntoView({ behavior: 'smooth' });

    }
    else if (ph_number) {
        if (!window.ph_iti.isValidNumber())
            $("#name-input")[0].scrollIntoView({ behavior: 'smooth' });
    }
    else if (aloy == "yes" && !regno) {
        alert("Please fill all the required fields.");
        $("#regno-input")[0].scrollIntoView({ behavior: 'smooth' });
    }
    else {
        console.log(full_name, email, wa_number, ph_number, aloy, regno, payment_type, upi_ref_no);
        await fetch("https://tedxsac.up.railway.app/register", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: email,
                name: full_name,
                wa_number: wa_number,
                ph_number: ph_number,
                aloy: aloy,
                regno: regno,
                payment_type: payment_type,
                upi_ref_no: upi_ref_no
            })
        })
            .then(async (response) => {
                const statusCode = response.status;
                const responseData = await response.json();
                if (statusCode === 200) {
                    console.log("Form submitted successfully");
                    $("#register-form-row").hide();
                    $("#success-row").show();
                    return;
                } else if (statusCode === 202) {
                    console.log("Email already registered");
                } else if (statusCode === 520) {
                    $("#modal-para").html(responseData.msg);
                    $("#modal").modal("show");
                    // Handle other status codes as needed
                } else {
                    console.log('Unexpected status code:', statusCode);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    $("#submit-loading").hide();
    $("#submit-btn").show();

}


// $(document).ready(function () {
//     resetForms();
// });

// function resetForms() {
//     for (i = 0; i < document.forms.length; i++) {
//         document.forms[i].reset();
//     }
// }
